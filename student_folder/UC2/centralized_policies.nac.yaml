---
# Centralized Policies Definitions and feature_policies
sdwan:
  centralized_policies:
    definitions:
      control_policy:
        custom_control_topology:
          - name: TOPOLOGY-DC-OUT-01
            description: TOPOLOGY-DC-OUT-01
            default_action_type: reject
            sequences:
              - id: 1
                base_action: accept
                name: TLOCS
                ip_type: ipv4
                type: tloc
                match_criterias:
                  site_list: BR-ALL
                actions:
                  omp_tag: 1000
              - id: 10
                base_action: accept
                name: Routes
                ip_type: ipv4
                type: route
                match_criterias:
                  site_list: BR-T1
                actions:
                  omp_tag: 200
              - id: 20
                base_action: accept
                name: Routes
                ip_type: ipv4
                type: route
                match_criterias:
                  site_list: BR-T2
                actions:
                  omp_tag: 300
          - name: TOPOLOGY-BR-T1-01
            description: TOPOLOGY-BR-T1-OUT-01
            default_action_type: reject
            sequences:
              - id: 1
                base_action: accept
                name: DC TLOCS
                ip_type: ipv4
                type: tloc
                match_criterias:
                  site_list: CENTRAL-DC
                actions:
                  preference: 1
              - id: 10
                base_action: accept
                name: DC Routes
                ip_type: ipv4
                type: route
                match_criterias:
                  site_list: CENTRAL-DC
                actions:
                  omp_tag: 100
              - id: 20
                base_action: accept
                name: BR Routes
                ip_type: ipv4
                type: route
                match_criterias:
                  site_list: BR-ALL
                actions:
                  omp_tag: 1000
          - name: TOPOLOGY-BR-T2-01
            description: TOPOLOGY-BR-T2-OUT-01
            default_action_type: reject
            sequences:
              - id: 1
                base_action: accept
                name: DC TLOCS
                ip_type: ipv4
                type: tloc
                match_criterias:
                  site_list: CENTRAL-DC
                actions:
                  preference: 1
              - id: 10
                base_action: accept
                name: DC Routes
                ip_type: ipv4
                type: route
                match_criterias:
                  site_list: CENTRAL-DC
                actions:
                  omp_tag: 100
              - id: 20
                base_action: accept
                name: BR Routes
                ip_type: ipv4
                type: route
                match_criterias:
                  site_list: BR-ALL
                actions:
                  omp_tag: 1000
        # hub_and_spoke_topology:
        #   - name: Hub-and-Spoke-Default
        #     description: Hub-and-Spoke-Default
        #     vpn_list: VPN-PROD
        #     hub_and_spoke_sites:
        #       - name: group1
        #         spokes:
        #           - site_list: BR-ALL
                    
        #             hubs:
        #               - site_list: 
      data_policy:
        application_aware_routing:
          - name: AAR-Policy-01
            description: General AAR policy
            default_action_type:
              sla_class_list: default
            sequences:
              - id: 1
                name: AAR-VOICE
                ip_type: ipv4
                type: app_route
                match_criterias:
                  application_list: VOICE-APPS
                actions:
                  counter_name: AAR-VOICE-APP
                  log: true
                  sla_class_list:
                    sla_class_list: SLA-VOICE
                    preferred_colors:
                      - "mpls"
                    when_sla_not_met: fallback_to_best_path
              - id: 2
                name: BUSINES-APPS
                ip_type: ipv4
                type: app_route
                match_criterias:
                  application_list: BUSINESS-APPS
                actions:
                  counter_name: AAR-BUSINESS-APPS
                  log: true
                  sla_class_list:
                    sla_class_list: SLA-BUSINESS
                    preferred_color_group: MPLS-BIZ
                    when_sla_not_met: fallback_to_best_path
              - id: 3
                name: BULK-APPS
                ip_type: ipv4
                type: app_route
                match_criterias:
                  application_list: BULK-APPS
                actions:
                  counter_name: AAR-BULK-APPS
                  log: true
                  sla_class_list:
                    sla_class_list: SLA-BULK
                    preferred_colors:
                      - "biz-internet"
                    when_sla_not_met: fallback_to_best_path
              - id: 4
                name: SLA-LOW-PRIORITY
                ip_type: ipv4
                type: app_route
                match_criterias:
                  application_list: LOW-PRIORITY-APPS
                actions:
                  counter_name: AAR-LOW-PRIORITY
                  log: true  
              - id: 5
                name: Default
                ip_type: ipv4
                type: app_route
                match_criterias:
                  source_data_prefix: 0.0.0.0/0
                actions:
                  counter_name: AAR-Default
                  log: true  
                  sla_class_list:
                    sla_class_list: SLA-DEFAULT
                    preferred_colors:
                      - "biz-internet"
                    when_sla_not_met: fallback_to_best_path    
        traffic_data:
          - name: DP-VPN10-01
            description: DP-VPN10-01
            default_action_type: accept
            sequences:
              - base_action: accept
                id: 1
                name: TRAFFIC-QOS
                ip_type: ipv4
                type: custom
                match_criterias:
                  application_list: VOICE-APPS
                actions:
                  log: true
                  counter_name: DP-VOICE-APPS
                  forwarding_class: CLASS-REALTIME
                  dscp: 46
              - base_action: accept
                id: 2
                name: TRAFFIC-QOS
                ip_type: ipv4
                type: custom
                match_criterias:
                  application_list: BUSINESS-APPS
                actions:
                  log: true
                  counter_name: DP-BUSINESS
                  forwarding_class: CLASS-BUSINESS
                  dscp: 26
              - base_action: accept
                id: 3
                name: TRAFFIC-QOS
                ip_type: ipv4
                type: custom
                match_criterias:
                  application_list: BULK-APPS
                actions:
                  log: true
                  counter_name: DP-BULK
                  forwarding_class: CLASS-BULK
                  dscp: 10
              - base_action: accept
                id: 4
                name: LOW-Priority-TLOC
                ip_type: ipv4
                type: custom
                match_criterias:
                  application_list: LOW-PRIORITY-APPS
                actions:
                  log: true
                  counter_name: DP-LOW-PRIORITY
                  forwarding_class: CLASS-LOW-PRIORITY
                  dscp: 8
                  local_tloc_list:
                    colors: 
                      - "biz-internet"
                    encaps: 
                      - "gre"
                    restrict: true
          - name: DP-VPN11-01
            description: DP-VPN11-01
            default_action_type: accept
            sequences:
              - base_action: drop
                id: 1
                name: BOGON DROP
                ip_type: ipv4
                type: custom
                match_criterias:
                  destination_data_prefix_list: DPL-BOGON-ADDR
                actions:
                  log: true
                  counter_name: DPL-BOGON-ADDR-DROP
              - base_action: accept
                id: 10
                name: DIA
                ip_type: ipv4
                type: custom
                match_criterias:
                  source_data_prefix: 0.0.0.0/0
                actions:
                  log: true
                  counter_name: DPL-DIA
                  nat_vpn:
                    vpn_id: 0
                    nat_vpn_fallback: true
        cflowd:
          - name: CFLOW_DEFINITION_01
            description: CFLOW_DEFINITION_01
            active_flow_timeout: 30
            inactive_flow_timeout: 3600
            sampling_interval: 30
            flow_refresh: 60
            protocol: ipv4
            tos: true
            remarked_dscp: true
            collectors:
              - vpn: 10
                ip_address: 10.0.10.101
                port: 2048
                transport: transport_udp
                source_interface: GigabitEthernet3
                export_spreading: enable
    feature_policies:
      - name: CP-Hub-and-Spoke-01
        description: Hub and Spoke | AAR | DP for QoS | cFlow
        custom_control_topology:
          - policy_definition: TOPOLOGY-DC-OUT-01
            site_region:
              site_lists_out:
                - CENTRAL-DC
          - policy_definition: TOPOLOGY-BR-T1-01
            site_region:
              site_lists_out:
                - BR-T1     
          - policy_definition: TOPOLOGY-BR-T2-01
            site_region:
              site_lists_out:
                - BR-T2   
        traffic_data:
          - policy_definition: DP-VPN10-01
            site_region_vpn:
              - direction: service
                site_lists:
                  - CENTRAL-DC
                  - BR-ALL
                vpn_lists:
                  - VPN-PROD
          - policy_definition: DP-VPN11-01
            site_region_vpn:
              - direction: service
                site_lists:
                  - CENTRAL-DC
                  - BR-ALL
                vpn_lists:
                  - VPN-Guest
        application_aware_routing:
          - policy_definition: AAR-Policy-01
            site_region_vpn:
              site_lists:
                - CENTRAL-DC
                - BR-ALL
              vpn_lists:
                - VPN-PROD
        cflowd:
          - policy_definition: CFLOW_DEFINITION_01
            site_lists:
              - DC-BR-ALL
    activated_policy: CP-Hub-and-Spoke-01
